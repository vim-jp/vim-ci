language: c

compiler:
  - clang
  - gcc

env:
  - COVERAGE=yes TEST=yes CFLAGS=--coverage LDFLAGS=--coverage FEATURES=huge
    "CONFOPT='--enable-perlinterp --enable-pythoninterp --enable-python3interp --enable-rubyinterp --enable-luainterp'"
  - COVERAGE=no TEST=yes FEATURES=small CONFOPT=
  - COVERAGE=no TEST=yes FEATURES=tiny  CONFOPT=

sudo: false

addons:
  apt:
    packages:
      - lcov
      - libperl-dev
      - python-dev
      - python3-dev
      - liblua5.1-0-dev
      - lua5.1

before_install:
  - pip install --user cpp-coveralls

script:
  - cd vim && ./configure --with-features=$FEATURES $CONFOPT --enable-fail-if-missing && make
  - ./src/vim --version
  - if [ "$TEST" = "yes" ]; then make test; fi

after_success:
  - if [ x"$COVERAGE" == "xyes" ] ; then cd vim && ~/.local/bin/coveralls -b src -x .xs -e src/xxd -e src/if_perl.c --encodings utf-8 latin-1 EUC-KR; fi

# vim:set sts=2 sw=2 tw=0 et:
